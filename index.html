<!DOCTYPE html>
<html>
<head>
  <title>SikkMixx Livex6</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #000;
      color: white;
      overflow: hidden;
    }


    /* CLUB INTRO SCREEN */
    #intro {
      position: fixed;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, #111 0%, #000 80%);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
      transition: opacity 1s ease;
    }

#visualizer {
  margin-top: 30px;
  width: 100%;
  height: 80px;
}

#adminBtn {
  position: fixed;
  top: 15px;
  right: 20px;
  opacity: 0.5;
  font-size: 14px;
  text-decoration: none;
  color: rgba(255,255,255,0.6);
  border: 1px solid rgba(255,255,255,0.3);
  padding: 6px 12px;
  border-radius: 20px;
  backdrop-filter: blur(6px);
  transition: all 0.3s ease;
  z-index: 20;
}

#adminBtn:hover {
  color: #ff00cc;
  opacity: 1;
  border-color: #ff00cc;
  box-shadow: 0 0 10px #ff00cc;
}


#registerBtn {
  position: fixed;
  top: 15px;
  left: 20px;
    opacity: 0.5;
  font-size: 14px;
  text-decoration: none;
  color: rgba(255,255,255,0.6);
  border: 1px solid rgba(255,255,255,0.3);
  padding: 6px 12px;
  border-radius: 20px;
  backdrop-filter: blur(6px);
  transition: all 0.3s ease;
  z-index: 20;
}

#registerBtn:hover {
  color: #00e0ff;
    opacity: 1;
  border-color: #00e0ff;
  box-shadow: 0 0 10px #00e0ff;
}








    #enterBtn {
      padding: 20px 50px;
      font-size: 22px;
      letter-spacing: 3px;
      background: transparent;
      border: 2px solid #ff00cc;
      color: #ff00cc;
      cursor: pointer;
      border-radius: 50px;
      box-shadow: 0 0 20px #ff00cc;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 10px #ff00cc; }
      50% { box-shadow: 0 0 40px #ff00cc; }
      100% { box-shadow: 0 0 10px #ff00cc; }
    }

    /* MAIN PLAYER */
    #main {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(-45deg, #000, #111, #1a1a1a);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      opacity: 0;
      transition: opacity 1s ease;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 0 40px rgba(255,0,204,0.3);
    }

    h1 {
      letter-spacing: 3px;
      margin-bottom: 20px;
    }

    .track-title {
      margin-bottom: 25px;
      font-size: 20px;
    }

    audio {
      width: 100%;
      filter: invert(1);
    }
	
	
	
	.equalizer {
  margin-top: 30px;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  gap: 6px;
  height: 50px;
}

.equalizer span {
  width: 6px;
  height: 10px;
  background: #ff00cc;
  box-shadow: 0 0 10px #ff00cc;
  animation: bounce 1s infinite ease-in-out;
}

/* stagger animation timing */
.equalizer span:nth-child(1) { animation-delay: 0s; }
.equalizer span:nth-child(2) { animation-delay: .1s; }
.equalizer span:nth-child(3) { animation-delay: .2s; }
.equalizer span:nth-child(4) { animation-delay: .3s; }
.equalizer span:nth-child(5) { animation-delay: .4s; }
.equalizer span:nth-child(6) { animation-delay: .5s; }
.equalizer span:nth-child(7) { animation-delay: .6s; }
.equalizer span:nth-child(8) { animation-delay: .7s; }

@keyframes bounce {
  0%, 100% { height: 10px; }
  50% { height: 50px; }
}

	
	
	
	
	
	
  </style>
</head>

<body>

<a href="/register.html" id="registerBtn">Register</a>
<a href="/admin.html" id="adminBtn">Admin</a>



<!-- INTRO SCREEN -->
<div id="intro">
  <h1>ðŸŽ§ SIKKMIXX LIVE</h1>
  <button id="enterBtn">ENTER THE MIX</button>
</div>

<!-- MAIN PLAYER -->
<div id="main">
  <div class="card">
    <h1>LIVE SET</h1>
    <div class="track-title" id="trackTitle">Loading...</div>
    <audio id="player" controls crossorigin="anonymous"></audio>

	<div class="equalizer">
<canvas id="visualizer"></canvas>

</div>

	
	
	
  </div>
</div>

<script>
const API = "https://api.sikkmixx.com"
let player = document.getElementById("player")

async function loadTrack() {
  const res = await fetch(`${API}/tracks`)
  const tracks = await res.json()

  if (tracks.length > 0) {
    const track = tracks[0]
    const encoded = encodeURIComponent(track.filename)


const cleanName = track.filename
  .split("-")
  .slice(1)
  .join("-")
  .replace(".mp3", "")
  .replace(/-/g, " ")

document.getElementById("trackTitle").innerText = cleanName



      track.filename.replace(".mp3","")

    player.src = `${API}/file/${encoded}`
  }

  else {
    document.getElementById("trackTitle").innerText =
      "No live track yet"
  }
}

loadTrack()

// ENTER BUTTON LOGIC
document.getElementById("enterBtn").addEventListener("click", async () => {

  if (!audioContext) {
    initVisualizer()
  }

  await audioContext.resume()
  player.play()

  document.getElementById("intro").style.opacity = 0
  setTimeout(() => {
    document.getElementById("intro").style.display = "none"
    document.getElementById("main").style.opacity = 1
  }, 1000)
})




const canvas = document.getElementById("visualizer")
const ctx = canvas.getContext("2d")

canvas.width = canvas.offsetWidth
canvas.height = canvas.offsetHeight

let audioContext
let analyser
let source
let dataArray


function initVisualizer() {

  audioContext = new (window.AudioContext || window.webkitAudioContext)()
  analyser = audioContext.createAnalyser()

  analyser.fftSize = 256          // better resolution
  analyser.smoothingTimeConstant = 0.8  // smoother motion

  source = audioContext.createMediaElementSource(player)
  source.connect(analyser)
  analyser.connect(audioContext.destination)

  const bufferLength = analyser.frequencyBinCount
  dataArray = new Uint8Array(bufferLength)

  function draw() {
    requestAnimationFrame(draw)

    analyser.getByteFrequencyData(dataArray)

    ctx.clearRect(0, 0, canvas.width, canvas.height)

    const bars = 32
    const step = Math.floor(bufferLength / bars)
    const barWidth = canvas.width / bars

for (let i = 0; i < bars; i++) {

  let sum = 0
  for (let j = 0; j < step; j++) {
    sum += dataArray[i * step + j]
  }

  let value = sum / step

  // normalize + compress
  let normalized = value / 255
  let scaled = Math.pow(normalized, 1.5) * canvas.height

  const x = i * barWidth
  const y = canvas.height - scaled

  // ðŸŽ¨ COLOR SHIFT BASED ON INTENSITY
  let hue = 280 - (normalized * 200)   // purple â†’ blue
  let brightness = 50 + (normalized * 50)

  ctx.fillStyle = `hsl(${hue}, 100%, ${brightness}%)`
  ctx.shadowBlur = 25
  ctx.shadowColor = `hsl(${hue}, 100%, 60%)`

  ctx.fillRect(x, y, barWidth - 3, scaled)
}

  }

  draw(
  
  
  )
}












</script>

</body>
</html>
